name = "chittydlvr"
main = "src/worker.js"
compatibility_date = "2025-09-01"
compatibility_flags = ["nodejs_compat"]
account_id = "0bc21e3a5a9de1a4cc843be9c3e98121"

[observability]
enabled = true

[[tail_consumers]]
service = "chittytrack"

# Routes
routes = [
  { pattern = "dlvr.chitty.cc/*", zone_name = "chitty.cc" },
  { pattern = "api.chitty.cc/dlvr/*", zone_name = "chitty.cc" }
]

# Environment Variables
[vars]
ENVIRONMENT = "production"
VERSION = "1.0.0"

# Secrets (set via `wrangler secret put <NAME>`)
# CHITTY_AUTH_SERVICE_TOKEN  — Bearer token auth
# SIGNING_KEY_JWK            — Persistent ECDSA P-256 private key (JWK)
# INTERNAL_API_KEY           — Internal service initialization
# CHITTY_ID                  — Service identity

# DNS: Requires proxied AAAA record → dlvr.chitty.cc → 100::

# Staging
[env.staging]
name = "chittydlvr-staging"
routes = [
  { pattern = "dlvr-staging.chitty.cc/*", zone_name = "chitty.cc" }
]
[env.staging.vars]
ENVIRONMENT = "staging"

# Development
[env.dev]
name = "chittydlvr-dev"
[env.dev.vars]
ENVIRONMENT = "development"
